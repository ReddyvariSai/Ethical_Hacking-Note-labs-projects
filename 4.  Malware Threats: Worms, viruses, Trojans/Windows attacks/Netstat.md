# **NETSTAT COMMANDS: THE ULTIMATE GUIDE WITH REAL-WORLD EXAMPLES**

## **PHILOSOPHY OF NETSTAT**
Netstat is **digital telepathy** - it lets you "hear" what your computer is saying to the world. Every connection is a conversation, and netstat is the translator.

---

## **1. THE FOUNDATIONAL TRIAD**

### **Command: `netstat -a`**
```cmd
netstat -a
```
**Example Output:**
```
Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    0.0.0.0:135            DESKTOP-J9D2F5L:0      LISTENING
  TCP    192.168.1.100:49678    52.114.128.32:443      ESTABLISHED
  UDP    0.0.0.0:5353           *:*                    LISTENING
```

**WHY USE THIS?**
- **Complete visibility** - shows ALL connections (TCP/UDP, listening/active)
- **First step in troubleshooting** - get the big picture
- **Baseline creation** - know what "normal" looks like
- **Port discovery** - find services you didn't know were running

**REAL-WORLD SCENARIO:**
```
You're a sysadmin. User says "Internet feels slow." 
You run `netstat -a` and see 200 ESTABLISHED connections.
Conclusion: Not a network problem - something is aggressively connecting.
```

---

## **2. THE PERFORMANCE COMMAND**

### **Command: `netstat -n`**
```cmd
netstat -n
```
**Example Output:**
```
Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    192.168.1.100:49678    52.114.128.32:443      ESTABLISHED
  TCP    192.168.1.100:49679    142.250.185.46:443     ESTABLISHED
```

**WHY USE THIS?**
- **Speed** - skips DNS resolution (no waiting for slow DNS)
- **Clarity** - IPs don't lie, hostnames can be misleading
- **Automation** - predictable output for scripts
- **Forensics** - exact IPs for investigation

**PRO TIP:** **ALWAYS use `-n` first** when troubleshooting. If you need hostnames, add `-f` later.

**REAL-WORLD SCENARIO:**
```
Security alert: "Suspicious connection to malicious domain."
You run `netstat -n | findstr 94.102.61.24` 
Faster than waiting for DNS that might be compromised.
```

---

## **3. THE SECURITY INVESTIGATOR**

### **Command: `netstat -b`**
```cmd
netstat -b
```
**Example Output:**
```
Active Connections

  TCP    192.168.1.100:49678    52.114.128.32:443      ESTABLISHED
  [chrome.exe]
  
  TCP    192.168.1.100:54321    45.67.89.123:4444      ESTABLISHED
  [backdoor.exe]  ← MALWARE!
```

**WHY USE THIS?**
- **Attribution** - connects network activity to specific programs
- **Malware hunting** - find unknown/unauthorized executables
- **Resource management** - see which apps are using bandwidth
- **Compliance** - verify only approved software makes connections

**CAUTION:** Requires **Administrator privileges** on Windows.

**REAL-WORLD SCENARIO:**
```
IDS alerts on port 4444 traffic. You run `netstat -b | findstr :4444`
Discovers `invoice_viewer.exe` is actually a Meterpreter backdoor.
```

---

## **4. THE PROCESS HUNTER**

### **Command: `netstat -o`**
```cmd
netstat -o
```
**Example Output:**
```
Active Connections

  Proto  Local Address          Foreign Address        State           PID
  TCP    192.168.1.100:49678    52.114.128.32:443      ESTABLISHED     4724
  TCP    192.168.1.100:49679    142.250.185.46:443     ESTABLISHED     4724
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
```

**Follow-up to identify process:**
```cmd
tasklist | findstr 4724
```
```
chrome.exe                   4724 Console                    1    245,232 K
```

**WHY USE THIS?**
- **Process identification** - find the exact program
- **Resource troubleshooting** - high bandwidth PID = investigate that process
- **Malware termination** - kill process by PID after identification
- **Service mapping** - which service owns which port

**REAL-WORLD SCENARIO:**
```
Firewall shows port 8080 open. `netstat -o | findstr :8080` shows PID 1234.
`tasklist | findstr 1234` reveals unauthorized Apache installation.
```

---

## **5. THE ULTIMATE SECURITY AUDIT**

### **Command: `netstat -anob`**
```cmd
netstat -anob
```
**This is THE command for security professionals.**

**WHY USE THIS?**
Combines:
- `-a` = All connections
- `-n` = Fast numeric output
- `-o` = Process IDs
- `-b` = Executable names

**One command gives you:**
1. All network activity
2. No DNS delays
3. Which process is responsible
4. The actual executable

**REAL-WORLD SCENARIO:**
```
Routine security audit. Run `netstat -anob` on all servers.
Server A shows: `[java.exe]` listening on port 4444.
Java shouldn't be there. Investigation finds cryptocurrency miner.
```

---

## **6. THE PORT DETECTIVE**

### **Command: `netstat -ano | findstr :PORT`**
```cmd
# Find what's using port 80
netstat -ano | findstr :80

# Find what's using port 443
netstat -ano | findstr :443

# Find RDP connections
netstat -ano | findstr :3389
```

**Example: Checking for web servers:**
```cmd
netstat -ano | findstr :80
```
```
TCP    0.0.0.0:80            0.0.0.0:0              LISTENING       1234
TCP    192.168.1.100:80      203.0.113.5:54321      ESTABLISHED     1234
```

**WHY USE THIS?**
- **Port conflicts** - "Address already in use" errors
- **Service verification** - Is my service really listening?
- **Security hardening** - Close unnecessary ports
- **Intrusion detection** - Unexpected services

**REAL-WORLD SCENARIO:**
```
You install IIS but get "Port 80 in use" error.
`netstat -ano | findstr :80` shows Skype using port 80.
Change Skype settings or IIS binding.
```

---

## **7. THE CONNECTION FILTER**

### **Command: `netstat -an | findstr ESTABLISHED`**
```cmd
netstat -an | findstr ESTABLISHED
```

**WHY USE THIS?**
- **Current activity only** - ignore listening/idle connections
- **Bandwidth analysis** - active connections use resources
- **Suspicious activity** - unexpected ESTABLISHED connections
- **Clean output** - focused on what's happening NOW

**Compare with listening ports:**
```cmd
# What CAN connect vs what IS connecting
netstat -an | findstr LISTENING    # Potential connections
netstat -an | findstr ESTABLISHED  # Actual connections
```

**REAL-WORLD SCENARIO:**
```
Server is slow. `netstat -an | findstr ESTABLISHED` shows 500+ connections.
Most are TIME_WAIT (recently closed). This is normal TCP behavior.
Not a current problem - just cleanup from heavy traffic.
```

---

## **8. THE STATISTICIAN**

### **Command: `netstat -s`**
```cmd
netstat -s
```
**Partial Output:**
```
IPv4 Statistics

  Packets Received                   = 4567890
  Received Header Errors             = 0
  Received Address Errors            = 23
  
TCP Statistics for IPv4

  Active Opens                        = 4567
  Failed Connection Attempts          = 23      ← HIGH = Problem!
  Segments Retransmitted              = 345     ← Should be <1%
```

**WHY USE THIS?**
- **Performance metrics** - packet loss, errors, retransmissions
- **Network health** - baseline and trend analysis
- **Troubleshooting** - high error counts indicate problems
- **Capacity planning** - connection rate trends

**KEY METRICS TO WATCH:**
- **Failed Connection Attempts** > 1% = Network/authentication issues
- **Segments Retransmitted** > 1% = Poor connection quality
- **Reset Connections** = Applications failing

**REAL-WORLD SCENARIO:**
```
Users complain of "slowness." `netstat -s` shows 15% retransmission rate.
This indicates packet loss. Check switches, cables, or ISP.
```

---

## **9. THE ROUTE MASTER**

### **Command: `netstat -r`**
```cmd
netstat -r
```
**Example Output:**
```
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination   Netmask         Gateway       Interface    Metric
          0.0.0.0     0.0.0.0     192.168.1.1    192.168.1.100     25
        127.0.0.0     255.0.0.0       On-link        127.0.0.1     331
```

**WHY USE THIS?**
- **Routing problems** - Can't reach certain networks
- **Multiple gateways** - Conflicting routes
- **VPN issues** - Routes not added properly
- **Network design** - Verify routing configuration

**INTERPRETATION:**
- **0.0.0.0** = Default route (to internet)
- **127.0.0.0** = Loopback (local machine)
- **192.168.1.0** = Local network

**REAL-WORLD SCENARIO:**
```
Can't reach corporate network (10.0.0.0/8) from laptop.
`netstat -r` shows no route to 10.0.0.0. 
VPN isn't adding routes properly.
```

---

## **10. THE INTERFACE ANALYST**

### **Command: `netstat -e`**
```cmd
netstat -e
```
**Example Output:**
```
Interface Statistics

                           Received            Sent
Bytes                    4,521,567,890     8,923,456,712
Unicast packets              345,678           456,789
Discards                          0                0
Errors                            2                1
```

**WHY USE THIS?**
- **Bandwidth monitoring** - Bytes sent/received
- **Network card issues** - Errors/discards indicate hardware problems
- **Traffic comparison** - Is traffic balanced across interfaces?
- **Baseline establishment** - Normal traffic patterns

**RED FLAGS:**
- **Errors > 0** = Physical layer problem (cable, NIC, switch)
- **Discards > 0** = Buffer overruns (network too busy)
- **Sudden spikes** = Possible malware/data exfiltration

**REAL-WORLD SCENARIO:**
```
Server NIC showing errors. `netstat -e` shows increasing errors.
Replace cable → errors continue → Replace NIC → errors stop.
```

---

## **11. THE REAL-TIME MONITOR**

### **Linux: `netstat -c` or `watch netstat`**
```bash
# Refresh every 2 seconds
netstat -c 2

# Or using watch
watch -n 2 "netstat -tan | grep ESTABLISHED"
```

### **Windows: PowerShell loop**
```powershell
while($true) {cls; netstat -an; Start-Sleep -Seconds 2}
```

**WHY USE THIS?**
- **Live monitoring** - See connections as they happen
- **Pattern recognition** - Bursty traffic, periodic connections
- **Attack detection** - Watch port scans in real-time
- **Troubleshooting** - See what happens when you reproduce issue

**REAL-WORLD SCENARIO:**
```
File server has intermittent slowdowns.
Run `watch -n 1 "netstat -tan | grep :445"` 
See bursts of connections from one IP = User running aggressive scans.
```

---

## **12. THE PROTOCOL SPECIALIST**

### **Command: `netstat -p PROTOCOL`**
```cmd
# TCP only
netstat -p tcp

# UDP only
netstat -p udp

# ICMP (Linux)
netstat -p icmp
```

**WHY USE THIS?**
- **Protocol-specific issues** - TCP vs UDP problems
- **Service verification** - DNS uses UDP 53, HTTP uses TCP 80
- **Firewall rules** - Verify which protocols are active
- **Application debugging** - Is app using expected protocol?

**REAL-WORLD SCENARIO:**
```
VoIP calls dropping. Check UDP (voice uses UDP):
`netstat -p udp | findstr :5060` ← SIP port
`netstat -p udp | findstr :10000-20000` ← RTP audio ports
```

---

## **13. THE STATE ANALYST**

### **Understanding Connection States:**
```cmd
# Filter by state
netstat -an | findstr TIME_WAIT
netstat -an | findstr CLOSE_WAIT
netstat -an | findstr SYN_SENT
```

**COMMON STATES & MEANING:**

| **State** | **Meaning** | **Troubleshooting Action** |
|-----------|------------|----------------------------|
| **LISTENING** | Ready for connections | Normal for servers |
| **ESTABLISHED** | Active connection | Normal communication |
| **TIME_WAIT** | Cleaning up closed connection | Normal, but high counts waste resources |
| **CLOSE_WAIT** | Remote closed, local hasn't | Application bug (not closing sockets) |
| **SYN_SENT** | Connection attempt sent | Firewall blocking, target down |

**REAL-WORLD SCENARIO:**
```
Server has 10,000 TIME_WAIT connections.
This consumes kernel resources. 
Solution: Reduce TCP timeout or increase ephemeral ports.
```

---

## **14. PRACTICAL SECURITY SCRIPTS**

### **Malware Hunt Script:**
```batch
@echo off
echo === MALWARE HUNT ===
echo.
echo 1. Unknown executables making connections:
netstat -b | findstr "\[" | findstr /v "chrome.exe firefox.exe svchost.exe"
echo.
echo 2. Suspicious ports (backdoors):
netstat -an | findstr ":4444 :31337 :6667 :8080 :12345"
echo.
echo 3. Foreign connections:
netstat -an | findstr ESTABLISHED | findstr /v "192.168. 10. 127.0.0.1"
```

### **Service Audit Script:**
```powershell
# What's listening that shouldn't be?
$allowed = @(80, 443, 22, 3389, 135, 445)
netstat -an | Where-Object {$_ -match "LISTENING"} | ForEach-Object {
    if ($_ -match ':(\d+)\s') {
        $port = $matches[1]
        if ($allowed -notcontains $port) {
            Write-Host "UNEXPECTED: Listening on port $port" -ForegroundColor Red
        }
    }
}
```

---

## **15. WHY THESE COMMANDS MATTER: THE BIG PICTURE**

### **For System Administrators:**
- **`netstat -tulpn`** = Service inventory and health check
- **`netstat -s`** = Network quality monitoring
- **`netstat -r`** = Routing troubleshooting

### **For Security Professionals:**
- **`netstat -anob`** = Full forensic snapshot
- **`netstat -b | findstr "["`** = Executable attribution
- **`netstat -an | findstr ESTABLISHED`** = Live threat detection

### **For Developers:**
- **`netstat -ano | findstr :PORT`** = Port conflict resolution
- **`netstat -an | findstr CLOSE_WAIT`** = Socket leak detection
- **`netstat -s`** = Network stack debugging

### **For Network Engineers:**
- **`netstat -e`** = Interface health
- **`netstat -r`** = Routing table verification
- **`netstat -s`** = Protocol statistics

---

## **MEMORY AID: The Netstat Mind Map**

```
netstat -anob  ← YOUR GO-TO COMMAND
    │
    ├── a = All (TCP/UDP, Listening/Active)
    ├── n = Numeric (Fast, no DNS)
    ├── o = Owner (PID - find the process)
    └── b = Binary (Executable name)
```

**Rules of Thumb:**
1. **Troubleshooting?** Start with `netstat -an`
2. **Security check?** Use `netstat -anob`
3. **Performance?** Check `netstat -s`
4. **Routing?** Use `netstat -r`
5. **Real-time?** Add interval or use `watch`

---

## **THE ULTIMATE TRUTH ABOUT NETSTAT**

Netstat doesn't just show connections—it reveals **intent**. 

Every line of output answers one of these questions:
1. **Who are you talking to?** (Foreign Address)
2. **What are you saying?** (Port = Service/Protocol)
3. **How's the conversation going?** (State)
4. **Who started this?** (PID/Executable)
5. **Where are messages getting lost?** (Statistics)

Master these commands, and you don't just see packets—you see **stories**. You see the user browsing Facebook, the server serving pages, the malware calling home, and the firewall doing its job.

**Final Pro Tip:** Netstat shows **outbound** connections that bypass firewalls. A host-based firewall might block inbound, but `netstat -anob` shows what's leaving. That's why it's essential for malware detection—you can't hide an outbound call home.
